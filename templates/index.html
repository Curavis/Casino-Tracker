<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Casino Tracker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçû</text></svg>">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        /* BASE STYLES */
        body { 
            font-family: Arial, sans-serif; 
            margin: 0;
            padding: 40px;
            background-color: #121212;
            color: #e0e0e0;
            text-align: center;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto;
            background: #1e1e1e;
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 8px 16px rgba(0,0,0,0.5);
        }
        h1, h2 { 
            text-align: center; 
            color: #ffffff;
        }

        /* TAB STYLES */
        .game-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #333;
        }
        .tab-button {
            padding: 12px 25px;
            cursor: pointer;
            border: none;
            background: #1e1e1e;
            color: #aaa;
            font-size: 1.1em;
            transition: background-color 0.3s, color 0.3s;
            border-radius: 8px 8px 0 0;
            border: 1px solid #1e1e1e;
            border-bottom: none;
        }
        .tab-button.active {
            background-color: #2c2c2c;
            color: #ffffff;
            border: 1px solid #333;
            border-bottom: none;
        }

        /* DATA DISPLAY */
        .data-display { 
            margin: 20px 0 30px; 
            padding: 20px; 
            border: 1px solid #333; 
            border-radius: 8px; 
            background-color: #2c2c2c;
        }
        .profit { 
            font-size: 2.8em; 
            font-weight: bold; 
            color: {% if net_profit_f.startswith('-') %}#ff6b6b{% else %}#3fcf81{% endif %}; 
        } 
        /* Specific profit colors for Odds/Evens, applied via JS */
        .oe-profit { 
            font-size: 2.8em; 
            font-weight: bold; 
            /* Base color, will be updated by JS */
            color: #3fcf81; 
        }


        /* WIN/LOSS BAR STYLES */
        .ratio-bar-container {
            width: 90%;
            height: 30px;
            background-color: #c0392b; 
            border-radius: 4px;
            margin: 10px auto 10px;
            display: flex;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
        }
        .win-bar, .loss-bar {
            transition: width 0.5s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        .win-bar { background-color: #27ae60; }
        .loss-bar { background-color: #c0392b; }


        /* BETTING CONTROLS */
        .bet-selector {
            margin-bottom: 20px;
        }
        #bet-amount, #oe-bet-amount {
            padding: 10px 15px;
            font-size: 1.1em;
            border-radius: 6px;
            border: 1px solid #555;
            background-color: #333;
            color: #e0e0e0;
            cursor: pointer;
        }
        .controls { 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            margin-bottom: 20px; 
        }
        .controls form { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 15px;
        }
        .controls button { 
            padding: 15px 30px; 
            font-size: 1.1em; 
            cursor: pointer; 
            border: none; 
            border-radius: 8px; 
            color: white; 
            width: 250px; 
            transition: background-color 0.2s;
        }
        #lose-btn, #oe-lose-btn { background-color: #c0392b; } 
        #lose-btn:hover, #oe-lose-btn:hover { background-color: #e74c3c; }
        #win-btn, #oe-win-btn { background-color: #27ae60; }  
        #win-btn:hover, #oe-win-btn:hover { background-color: #2ecc71; }
        #winner-input { 
            padding: 10px; border: 1px solid #555; border-radius: 4px; 
            width: 226px; text-align: center; background-color: #333; color: #e0e0e0;
        }

        /* MESSAGES & LEADERBOARD */
        .clipboard-buttons button { 
            margin: 8px; padding: 12px 18px; background-color: #2980b9; 
            color: white; border: none; border-radius: 6px; cursor: pointer;
            transition: background-color 0.2s;
        }
        .clipboard-buttons button:hover { background-color: #3498db; }
        .leaderboard, .messages { 
            margin-top: 40px; border-top: 1px solid #333; padding-top: 20px; 
        }
        
        /* SCROLLING */
        .leaderboard-scroll {
            max-height: 200px; overflow-y: scroll; overflow-x: hidden; 
            padding-right: 10px; margin: 10px auto 0; text-align: left; 
            background-color: #2c2c2c; border-radius: 4px;
        }
        .leaderboard-scroll ul { list-style: none; padding-left: 10px; margin: 0; }
        .leaderboard-scroll li {
            background-color: #2c2c2c; margin: 2px 0; padding: 6px; 
            border-radius: 4px; width: 95%; 
        }
        
        #copy-status { margin-top: 10px; font-weight: bold; color: #aaa; }

        /* CHART SPECIFIC STYLES */
        .chart-container {
            margin-top: 40px; padding-top: 20px; border-top: 1px solid #333;
            max-width: 100%; height: 300px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Casino Game Tracker</h1>
        
        <div class="game-tabs">
            <button class="tab-button active" onclick="showGame('wheel')">Spinning Wheel (9x)</button>
            <button class="tab-button" onclick="showGame('odds')">Odds or Evens (1.8x)</button>
        </div>

        <div id="wheel-game" class="game-content">
            
            <div class="data-display">
                <h2>NET PROFIT: $<span class="profit" id="sw-profit">{{ net_profit_f }}</span></h2> 
                <p>TOTAL SPINS: <strong>{{ sw_total_spins }}</strong> &bull; LOSS STREAK: <strong>{{ loss_streak }}</strong> SPINS</p>

                <p style="margin-top: 20px;">WIN/LOSS RATIO: <strong>{{ sw_win_loss_display }}</strong></p>
                <div class="ratio-bar-container">
                    {% if sw_total_spins > 0 %}
                        <div class="win-bar" style="width: {{ sw_win_percent }}%;">
                            {% if sw_win_percent > 10 %}{{ sw_win_percent }}%{% endif %}
                        </div>
                        <div class="loss-bar" style="width: {{ sw_loss_percent }}%;">
                            {% if sw_loss_percent > 10 %}{{ sw_loss_percent }}%{% endif %}
                        </div>
                    {% else %}
                        <div class="win-bar" style="width: 100%; background-color: #555;">
                            No Data Yet
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="bet-selector">
                <label for="bet-amount">Current Bet Amount:</label>
                <select id="bet-amount" onchange="updateButtonLabels('wheel')">
                    {% for bet in bet_options %}
                        <option value="{{ bet }}" {% if bet == default_bet %}selected{% endif %}>
                            ${{ '{:,.0f}'.format(bet) }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="controls">
                <form method="POST" action="{{ url_for('player_loses_route') }}" id="lose-form">
                    <button type="submit" id="lose-btn"></button>
                    <input type="hidden" name="bet_amount_hidden" id="lose-bet-hidden" value="{{ default_bet }}">
                </form>
                
                <form method="POST" action="{{ url_for('player_wins_route') }}" id="win-form">
                    <button type="submit" id="win-btn"></button>
                    <input type="text" name="winner_name" id="winner-input" placeholder="Winner's Name" required>
                    <input type="hidden" name="bet_amount_hidden" id="win-bet-hidden" value="{{ default_bet }}">
                </form>
            </div>
            
            <div class="leaderboard">
                <h2>All-Time Winners Leaderboard</h2>
                <div class="leaderboard-scroll">
                    <ul>
                        {% for player, winnings_f in leaderboard_f %} 
                            <li>{{ loop.index }}. {{ player }}: ${{ winnings_f }}</li>
                        {% else %}
                            <li>No winners yet.</li>
                        {% endfor %}
                    </ul>
                </div>
            </div>

            <div class="chart-container">
                <h2>Profit History (Spinning Wheel)</h2>
                <canvas id="wheelChart"></canvas>
            </div>

        </div>

        <div id="odds-game" class="game-content" style="display:none;">

            <div class="data-display">
                <h2>NET PROFIT: $<span class="oe-profit" id="oe-profit">{{ oe_net_profit_f }}</span></h2> 
                <p>TOTAL BETS: <strong>{{ oe_total_spins }}</strong></p>

                <p style="margin-top: 20px;">WIN/LOSS RATIO: <strong>{{ oe_win_loss_display }}</strong></p>
                <div class="ratio-bar-container">
                    {% if oe_total_spins > 0 %}
                        <div class="win-bar" style="width: {{ oe_win_percent }}%;">
                            {% if oe_win_percent > 10 %}{{ oe_win_percent }}%{% endif %}
                        </div>
                        <div class="loss-bar" style="width: {{ oe_loss_percent }}%;">
                            {% if oe_loss_percent > 10 %}{{ oe_loss_percent }}%{% endif %}
                        </div>
                    {% else %}
                        <div class="win-bar" style="width: 100%; background-color: #555;">
                            No Data Yet
                        </div>
                    {% endif %}
                </div>
            </div>

            <div class="bet-selector">
                <label for="oe-bet-amount">Current Bet Amount:</label>
                <select id="oe-bet-amount" onchange="updateButtonLabels('odds')">
                    {% for bet in bet_options %}
                        <option value="{{ bet }}" {% if bet == default_bet %}selected{% endif %}>
                            ${{ '{:,.0f}'.format(bet) }}
                        </option>
                    {% endfor %}
                </select>
            </div>

            <div class="controls">
                <form method="POST" action="{{ url_for('odd_even_loses_route') }}" id="oe-lose-form">
                    <button type="submit" id="oe-lose-btn"></button>
                    <input type="hidden" name="bet_amount_hidden" id="oe-lose-bet-hidden" value="{{ default_bet }}">
                </form>
                
                <form method="POST" action="{{ url_for('odd_even_wins_route') }}" id="oe-win-form">
                    <button type="submit" id="oe-win-btn"></button>
                    <input type="hidden" name="bet_amount_hidden" id="oe-win-bet-hidden" value="{{ default_bet }}">
                </form>
            </div>

            <div class="chart-container">
                <h2>Profit History (Odds or Evens)</h2>
                <canvas id="oeChart"></canvas>
            </div>

        </div>
        <div class="messages">
            <h2>Quick Invite Copier</h2>
            <div class="clipboard-buttons">
                {% for key, message in messages.items() %}
                    {% set display_name = key %}
                    {% set message_content = message %}

                    {% if key == 'Loss Streak Alert' %}
                        {% set display_name = 'Loss Streak Message' %}
                        {% set message_content = loss_streak ~ ' losses in a row! Can\'t be much longer!' %}
                    {% endif %}

                    <button onclick="copyToClipboard('{{ message_content | e }}', '{{ display_name }}')">
                        Copy: {{ display_name }}
                    </button>
                {% endfor %}
            </div>
            <p id="copy-status">Ready to copy.</p>
        </div>
        
    </div>

    <script>
        const SW_MULTIPLIER = 9;   // Spinning Wheel payout multiplier
        const OE_MULTIPLIER = 1.8; // Odds or Evens payout multiplier

        // Helper function for currency formatting
        function formatCurrency(num) {
            return num.toLocaleString();
        }

        // --- TAB SWITCHING LOGIC ---
        function showGame(gameId) {
            // Hide all game content sections
            document.querySelectorAll('.game-content').forEach(el => {
                el.style.display = 'none';
            });
            // Deactivate all buttons
            document.querySelectorAll('.tab-button').forEach(el => {
                el.classList.remove('active');
            });
            
            // Show the selected game content
            document.getElementById(gameId + '-game').style.display = 'block';
            // Activate the corresponding button
            document.querySelector(`.tab-button[onclick="showGame('${gameId}')"]`).classList.add('active');

            // Re-render chart for the currently active tab to prevent rendering issues
            if (gameId === 'wheel' && window.wheelChartInstance) {
                 window.wheelChartInstance.update();
            } else if (gameId === 'odds' && window.oeChartInstance) {
                 window.oeChartInstance.update();
            }
        }

        // --- BUTTON LABEL & INPUT UPDATE LOGIC ---
        function updateButtonLabels(gameMode) {
            if (gameMode === 'wheel') {
                const betSelect = document.getElementById('bet-amount');
                const betAmount = parseInt(betSelect.value);

                // Calculations
                const netLoss = betAmount;
                const netWin = (betAmount * SW_MULTIPLIER) - betAmount;

                // Update UI
                document.getElementById('lose-btn').textContent = `Player LOSES (+ $${formatCurrency(netLoss)})`;
                document.getElementById('win-btn').textContent = `Player WINS (- $${formatCurrency(netWin)})`;
                
                // Update hidden input fields for form submission
                document.getElementById('lose-bet-hidden').value = betAmount;
                document.getElementById('win-bet-hidden').value = betAmount;
            } else if (gameMode === 'odds') {
                const betSelect = document.getElementById('oe-bet-amount');
                const betAmount = parseInt(betSelect.value);

                // Calculations (1.8x payout)
                const netLoss = betAmount;
                // Rounding is essential here as 1.8x often results in floats
                const netWin = Math.round((betAmount * OE_MULTIPLIER) - betAmount);

                // Update UI
                document.getElementById('oe-lose-btn').textContent = `Player LOSES (+ $${formatCurrency(netLoss)})`;
                document.getElementById('oe-win-btn').textContent = `Player WINS (- $${formatCurrency(netWin)})`;

                // Update hidden input fields for form submission
                document.getElementById('oe-lose-bet-hidden').value = betAmount;
                document.getElementById('oe-win-bet-hidden').value = betAmount;
            }
        }

        // --- CHART INITIALIZATION ---
        function initChart(canvasId, history, label, color) {
            const ctx = document.getElementById(canvasId).getContext('2d');
            const labels = history.map((_, index) => 'Bet ' + index);
            
            const data = {
                labels: labels,
                datasets: [{
                    label: label,
                    data: history,
                    borderColor: color, 
                    backgroundColor: `rgba(${color === '#3498db' ? '52, 152, 219' : '230, 126, 34'}, 0.2)`, 
                    fill: true,
                    tension: 0.1
                }]
            };

            const config = {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: { display: true, text: 'Profit/Loss ($)', color: '#e0e0e0' },
                            grid: { color: '#333' },
                            ticks: {
                                color: '#e0e0e0',
                                callback: function(value) { return '$' + value.toLocaleString(); }
                            }
                        },
                        x: {
                            grid: { color: '#333' },
                            ticks: { color: '#e0e0e0' }
                        }
                    },
                    plugins: {
                        legend: { labels: { color: '#ffffff' } }
                    }
                }
            };
            return new Chart(ctx, config);
        }
        
        // --- CLIPBOARD LOGIC ---
        function copyToClipboard(text, key) {
            // Clipboard logic remains the same
            text = text.replace(/&quot;/g, '"').replace(/&#39;/g, "'"); 
            const statusElement = document.getElementById('copy-status');
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed'; 
            document.body.appendChild(textarea);
            
            textarea.select();
            
            try {
                document.execCommand('copy');
                statusElement.textContent = `'${key}' Copied!`;
                statusElement.style.color = 'green';
            } catch (err) {
                console.error('Copy method failed: ', err);
                statusElement.textContent = 'ERROR: Copy failed.';
                statusElement.style.color = 'red';
            } finally {
                document.body.removeChild(textarea);
                setTimeout(() => {
                    statusElement.textContent = 'Ready to copy.';
                    statusElement.style.color = 'gray';
                }, 1500);
            }
        }
        
        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', function() {
            // 1. Initialize button labels for both modes
            updateButtonLabels('wheel'); 
            updateButtonLabels('odds'); 
            
            // 2. Initialize Charts
            const swProfitHistory = JSON.parse('{{ profit_history | tojson | safe }}');
            const oeProfitHistory = JSON.parse('{{ oe_profit_history | tojson | safe }}');
            
            window.wheelChartInstance = initChart('wheelChart', swProfitHistory, 'Net Profit (Wheel)', '#3498db');
            window.oeChartInstance = initChart('oeChart', oeProfitHistory, 'Net Profit (Odds/Evens)', '#e67e22'); // Orange for new game
            
            // 3. Set Initial Tab
            showGame('wheel'); 

            // 4. Set initial color for OE profit text based on data
            const oeProfitElement = document.getElementById('oe-profit');
            if (oeProfitElement.textContent.trim().startsWith('-')) {
                oeProfitElement.style.color = '#ff6b6b'; // Red
            } else {
                oeProfitElement.style.color = '#3fcf81'; // Green
            }
            
        });
    </script>
</body>
</html>
