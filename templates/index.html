<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Casino Tracker</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçû</text></svg>">
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        /* DARK THEME & CENTERING */
        body { 
            font-family: Arial, sans-serif; 
            margin: 0;
            padding: 40px;
            background-color: #121212; /* Very dark gray background */
            color: #e0e0e0; /* Light text color */
            text-align: center; /* Center everything by default */
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; /* Center container horizontally */
            background: #1e1e1e; /* Darker container background */
            padding: 30px; 
            border-radius: 12px; 
            box-shadow: 0 8px 16px rgba(0,0,0,0.5); /* Stronger shadow for depth */
        }
        h1, h2 { 
            text-align: center; 
            color: #ffffff;
        }

        /* DATA DISPLAY */
        .data-display { 
            margin: 20px 0 30px; 
            padding: 20px; 
            border: 1px solid #333; 
            border-radius: 8px; 
            background-color: #2c2c2c;
        }
        .profit { 
            font-size: 2.8em; 
            font-weight: bold; 
            color: {% if net_profit_f.startswith('-') %}#ff6b6b{% else %}#3fcf81{% endif %}; 
        } 

        /* NEW: BET DROPDOWN STYLES */
        .bet-selector {
            margin-bottom: 20px;
        }
        #bet-amount {
            padding: 10px 15px;
            font-size: 1.1em;
            border-radius: 6px;
            border: 1px solid #555;
            background-color: #333;
            color: #e0e0e0;
            cursor: pointer;
        }


        /* WIN/LOSS BAR STYLES */
        .ratio-bar-container {
            width: 90%;
            height: 30px;
            background-color: #c0392b; 
            border-radius: 4px;
            margin: 10px auto 10px;
            display: flex;
            overflow: hidden;
            box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.5);
        }
        .win-bar {
            background-color: #27ae60; 
            transition: width 0.5s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }
        .loss-bar {
            background-color: #c0392b; 
            transition: width 0.5s ease-in-out;
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-weight: bold;
            font-size: 0.9em;
        }


        /* CONTROLS (BUTTON ALIGNMENT FIX) */
        .controls { 
            display: flex; 
            justify-content: center; 
            gap: 20px; 
            margin-bottom: 20px; 
        }
        .controls form { 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            gap: 15px;
        }
        .controls button { 
            padding: 15px 30px; 
            font-size: 1.1em; 
            cursor: pointer; 
            border: none; 
            border-radius: 8px; 
            color: white; 
            width: 250px; 
            transition: background-color 0.2s;
        }
        #lose-btn { 
            background-color: #c0392b; 
        } 
        #lose-btn:hover {
            background-color: #e74c3c;
        }
        #win-btn { 
            background-color: #27ae60;  
        }
        #win-btn:hover {
            background-color: #2ecc71;
        }
        #winner-input { 
            padding: 10px; 
            border: 1px solid #555; 
            border-radius: 4px; 
            width: 226px; 
            text-align: center;
            background-color: #333; 
            color: #e0e0e0;
        }

        /* MESSAGES & LEADERBOARD */
        .clipboard-buttons button { 
            margin: 8px; 
            padding: 12px 18px; 
            background-color: #2980b9; 
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .clipboard-buttons button:hover {
            background-color: #3498db;
        }
        .leaderboard, .messages { 
            margin-top: 40px; 
            border-top: 1px solid #333; 
            padding-top: 20px; 
        }
        
        /* LEADERBOARD SCROLL FIX */
        .leaderboard-scroll {
            max-height: 200px; 
            overflow-y: scroll; 
            overflow-x: hidden; 
            padding-right: 10px; 
            margin: 10px auto 0;
            text-align: left; 
            background-color: #2c2c2c; 
            border-radius: 4px;
        }
        
        .leaderboard-scroll ul {
            list-style: none;
            padding-left: 10px; 
            margin: 0; 
        }

        .leaderboard-scroll li {
            background-color: #2c2c2c; 
            margin: 2px 0;
            padding: 6px;
            border-radius: 4px;
            width: 95%; 
        }
        
        #copy-status { 
            margin-top: 10px; 
            font-weight: bold; 
            color: #aaa;
        }

        /* CHART SPECIFIC STYLES */
        .chart-container {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid #333;
            max-width: 100%; 
            height: 300px; 
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Spinning Wheel Game Tracker</h1>
        
        <div class="data-display">
            <h2>NET PROFIT: $<span class="profit">{{ net_profit_f }}</span></h2> 
            <p>TOTAL SPINS: <strong>{{ total_spins }}</strong> &bull; LOSS STREAK: <strong>{{ loss_streak }}</strong> SPINS</p>

            <p style="margin-top: 20px;">WIN/LOSS RATIO: <strong>{{ win_loss_display }}</strong></p>
            <div class="ratio-bar-container">
                {% if total_spins > 0 %}
                    <div class="win-bar" style="width: {{ win_percent }}%;">
                        {% if win_percent > 10 %}{{ win_percent }}%{% endif %}
                    </div>
                    <div class="loss-bar" style="width: {{ loss_percent }}%;">
                        {% if loss_percent > 10 %}{{ loss_percent }}%{% endif %}
                    </div>
                {% else %}
                    <div class="win-bar" style="width: 100%; background-color: #555;">
                        No Data Yet
                    </div>
                {% endif %}
            </div>
            
        </div>

        <div class="bet-selector">
            <label for="bet-amount">Current Bet Amount:</label>
            <select id="bet-amount" onchange="updateButtonLabels()">
                {% for bet in bet_options %}
                    <option value="{{ bet }}" {% if bet == default_bet %}selected{% endif %}>
                        ${{ '{:,.0f}'.format(bet) }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="controls">
            <form method="POST" action="{{ url_for('player_loses_route') }}" id="lose-form">
                <button type="submit" id="lose-btn"></button>
                <input type="hidden" name="bet_amount_hidden" id="lose-bet-hidden" value="{{ default_bet }}">
            </form>
            
            <form method="POST" action="{{ url_for('player_wins_route') }}" id="win-form">
                <button type="submit" id="win-btn"></button>
                <input type="text" name="winner_name" id="winner-input" placeholder="Winner's Name" required>
                <input type="hidden" name="bet_amount_hidden" id="win-bet-hidden" value="{{ default_bet }}">
            </form>
        </div>

        <div class="messages">
            <h2>Quick Invite Copier</h2>
            <div class="clipboard-buttons">
                {% for key, message in messages.items() %}
                    {% set display_name = key %}
                    {% set message_content = message %}

                    {% if key == 'Loss Streak Alert' %}
                        {% set display_name = 'Loss Streak Message' %}
                        {% set message_content = loss_streak ~ ' losses in a row! Can\'t be much longer!' %}
                    {% endif %}

                    <button onclick="copyToClipboard('{{ message_content | e }}', '{{ display_name }}')">
                        Copy: {{ display_name }}
                    </button>
                {% endfor %}
            </div>
            <p id="copy-status">Ready to copy.</p>
        </div>

        <div class="leaderboard">
            <h2>All-Time Winners Leaderboard</h2>
            <div class="leaderboard-scroll">
                <ul>
                    {% for player, winnings_f in leaderboard_f %} 
                        <li>{{ loop.index }}. {{ player }}: ${{ winnings_f }}</li>
                    {% else %}
                        <li>No winners yet.</li>
                    {% endfor %}
                </ul>
            </div>
        </div>
        
        <div class="chart-container">
            <h2>Profit History</h2>
            <canvas id="profitChart"></canvas>
        </div>
        
    </div>

    <script>
        const MULTIPLIER = 9; // Total payout is 9x the bet amount

        function formatCurrency(num) {
            // Converts a number to a string with commas (e.g., 25000 -> 25,000)
            return num.toLocaleString();
        }

        function updateButtonLabels() {
            const betSelect = document.getElementById('bet-amount');
            const betAmount = parseInt(betSelect.value);

            // Calculate win/loss values
            const netLoss = betAmount;
            const netWin = (betAmount * MULTIPLIER) - betAmount;

            // Update Lose Button
            const loseBtn = document.getElementById('lose-btn');
            loseBtn.textContent = `Player LOSES (+ $${formatCurrency(netLoss)})`;
            
            // Update Win Button
            const winBtn = document.getElementById('win-btn');
            winBtn.textContent = `Player WINS (- $${formatCurrency(netWin)})`;

            // Update hidden input fields for form submission
            document.getElementById('lose-bet-hidden').value = betAmount;
            document.getElementById('win-bet-hidden').value = betAmount;
        }

        function copyToClipboard(text, key) {
            // Clipboard logic remains the same
            text = text.replace(/&quot;/g, '"').replace(/&#39;/g, "'"); 
            const statusElement = document.getElementById('copy-status');
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed'; 
            document.body.appendChild(textarea);
            
            textarea.select();
            
            try {
                document.execCommand('copy');
                statusElement.textContent = `'${key}' Copied!`;
                statusElement.style.color = 'green';
            } catch (err) {
                console.error('Copy method failed: ', err);
                statusElement.textContent = 'ERROR: Copy failed.';
                statusElement.style.color = 'red';
            } finally {
                document.body.removeChild(textarea);
                setTimeout(() => {
                    statusElement.textContent = 'Ready to copy.';
                    statusElement.style.color = 'gray';
                }, 1500);
            }
        }
        
        // --- CHART.JS LOGIC ---
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize button labels on page load
            updateButtonLabels(); 
            
            // Chart logic remains the same
            const profitHistory = JSON.parse('{{ profit_history | tojson | safe }}');
            const labels = profitHistory.map((_, index) => 'Spin ' + index);
            const data = {
                labels: labels,
                datasets: [{
                    label: 'Net Profit',
                    data: profitHistory,
                    borderColor: '#3498db', 
                    backgroundColor: 'rgba(52, 152, 219, 0.2)', 
                    fill: true,
                    tension: 0.1
                }]
            };

            const config = {
                type: 'line',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            title: {
                                display: true,
                                text: 'Profit/Loss ($)',
                                color: '#e0e0e0'
                            },
                            grid: {
                                color: '#333' 
                            },
                            ticks: {
                                color: '#e0e0e0',
                                callback: function(value, index, ticks) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: '#333'
                            },
                            ticks: {
                                color: '#e0e0e0'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#ffffff' 
                            }
                        }
                    }
                }
            };

            const ctx = document.getElementById('profitChart').getContext('2d');
            new Chart(ctx, config);
        });
    </script>
</body>
</html>
